<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SMARTAQNET-SCOOTER: Smart Air Quality Network (SMARTAQNET) for Scooter</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="monogram.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="monogram.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SMARTAQNET-SCOOTER
   </div>
   <div id="projectbrief">Smart Air Quality Network Crowdsensor Firmware for Sooter</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Smart Air Quality Network (SMARTAQNET) for Scooter </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>SMARTAQNET project is aimed at development of a close-meshed network of local fine-dust data, which can be fed and used well by general public. Further details can be checked at: <a href="http://www.smartaq.net">http://www.smartaq.net</a>.<br />
 This script uses a ESP32 Board, a SDS011 particulate matter sensor and a BME280 sensor or a DHT22 sensor. It used A9G GPRS/GPS Module to setup data communication with a server. The Fig-1 shows the main board having different sensors connected together. The ESP32 is also refered to as crowdsensor. Following is the details for differnt features and steps to start:<br />
</p><ul>
<li>Install the arduino, board and required libraies as explained in ...</li>
<li>Connect the hardware as explained in ....</li>
<li>Configure the constants in the code as explained in .....</li>
<li>Compile and upload the cdes as explained in <a class="el" href="index.html#upload">Firmware Uploading</a> and ....</li>
<li>Configure the SIM and GPRS and other parameters as explained in ....</li>
<li>If everything is installed and configured perfectly, there should be no error i.e., E0 as explained in ....</li>
<li>If there is any errors please look into error or known bug section as explained in ...</li>
<li>For detailed debugging uncomment RELEASE constant. Some quick trick will also save the time as shown in .... </li>
</ul>
<h2><a class="anchor" id="sdso11"></a>
SDS011 Dust Sensor Usage</h2>
<ul>
<li>Hardware Pins: it uses transmit <a class="el" href="sensor_8h.html#a7130f8006502cdaa31094baa3f4dd3fa" title="SDS011 TXD pin is connected at RXD of Serial2 Object.">SDS011_TXD</a> (13) and recieve <a class="el" href="sensor_8h.html#ad2b404eb4de525cef31b8413f5d14b13" title="SDS011 RXD pin is connected at TXD of Serial2 Object (no need to physically connect)">SDS011_RXD</a> (17) pins</li>
<li>SERIAL Port: it uses the HardwareSerial port 2 for <a class="el" href="sensor_8h.html#a8f7824c0f2a3aa7e9bac94eac190fa7e" title="use Serial 2 Object">SDS_SERIAL</a> </li>
</ul>
<h2><a class="anchor" id="bme280"></a>
BME280 Sensor Usage</h2>
<ul>
<li>Hardware Pins: it uses SDA <a class="el" href="sensor_8h.html#ad9e594e426bce833af06dea308dbbf9a" title="BME280 I2C SDA pin.">BME_SDA</a> (21) and SCL <a class="el" href="sensor_8h.html#a5db75d8e5f3deda546603b949c520446" title="BME280 I2C SCL pin.">BME_SCL</a> (22) pins</li>
<li>I2C Port: to avoid any mismatch it uses Wire1 (default is Wire0) in bme.begin(BME_ADDR, &amp;Wire1)</li>
<li>I2C address: <a class="el" href="sensor_8h.html#a9f6149e98e70e1d5be5f0f33921cb7d7" title="BME280 I2C Address 0x77 for Red, 0x76 for Purple (chinese)">BME_ADDR</a> as 0x77 for Red, 0x76 for Purple (chinese)</li>
</ul>
<h2><a class="anchor" id="flowchart"></a>
FlowCharts</h2>
<p>The project work-flow can be see in the TODO</p>
<h2><a class="anchor" id="const"></a>
Important Constants</h2>
<p>Have a look at the following constants to configure them accordingly. These constants needs to be configured before the firmware is uploaded.</p><ul>
<li>in the file <a class="el" href="sensor_8h.html" title="variable and definitions for sensors">sensor.h</a><ul>
<li><a class="el" href="sensor_8h.html#a661d236dd49f3aef3a2cf46cf6a1405e" title="DHT22 sensor communication pin.">DHT_PIN</a> 21, set DHT22 sensor communication pin</li>
<li><a class="el" href="sensor_8h.html#a9f6149e98e70e1d5be5f0f33921cb7d7" title="BME280 I2C Address 0x77 for Red, 0x76 for Purple (chinese)">BME_ADDR</a> 0x77, set BME280 I2C Address 0x77 for Red, 0x76 for Purple</li>
<li><a class="el" href="sensor_8h.html#ad9e594e426bce833af06dea308dbbf9a" title="BME280 I2C SDA pin.">BME_SDA</a>, set BME280 I2C SDA pin</li>
<li><a class="el" href="sensor_8h.html#a5db75d8e5f3deda546603b949c520446" title="BME280 I2C SCL pin.">BME_SCL</a>, set BME280 I2C SCL pin</li>
<li><a class="el" href="sensor_8h.html#a7130f8006502cdaa31094baa3f4dd3fa" title="SDS011 TXD pin is connected at RXD of Serial2 Object.">SDS011_TXD</a>, set SDS011 TXD pin is connected at RXD of Serial2 Object</li>
<li><a class="el" href="sensor_8h.html#ad2b404eb4de525cef31b8413f5d14b13" title="SDS011 RXD pin is connected at TXD of Serial2 Object (no need to physically connect)">SDS011_RXD</a>, set SDS011 RXD pin is connected at TXD of Serial2 Object (no need to physically connect)</li>
</ul>
</li>
<li>in the file <a class="el" href="main_8h.html" title="This the main page for the SMARTAQNET which is the core of the project.">main.h</a><ul>
<li><a class="el" href="main_8h.html#aa14dc39d52ab121ceb570f1a265385e0" title="firmware version, (for intermediate versions being actively worked on, append &quot;pre&quot; to number,...">FIRMWARE_VERSION</a> controls the hard-coded firmware version of the code</li>
<li><a class="el" href="main_8h.html#af06baee05280c189592215d5ea08e7ef" title="Software.version.">sw_version</a> describes the software version of the Thing's software properties</li>
<li><a class="el" href="main_8h.html#acbd8a4cec684c263a6cc312c70d45ef3" title="Hardware.Revision.">hw_date</a> describes the hardware revision timestamp of the Thing's hardware properties</li>
<li><a class="el" href="main_8h.html#acbb11c1e34784cf1e3147029f942bfd6" title="Debugging, uncomment to switch servers to release version, enable sending to madavi and luftdaten....">BASE_URL</a> HTTP Server Address</li>
<li>RELEASE controls the debugging prints and <a class="el" href="main_8h.html#a7e7232f278193dd8684f973ee70ef3f5" title="Define MYDEBUG for controlling debugging.">MY_DEBUG</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="prereq"></a>
Pre-requisites</h1>
<ol type="1">
<li>Arrange the required <a class="el" href="index.html#hw_sec">Hardware</a> and carry out the <a class="el" href="index.html#wiring">Wirings</a>.</li>
<li>Install the the <a class="el" href="index.html#arduinoide">Arduino IDE</a></li>
<li>Install the <a class="el" href="index.html#boardlib">ESP32 Arduino core</a></li>
<li>Install the recommended <a class="el" href="index.html#lib">Required Libraries</a></li>
</ol>
<h1><a class="anchor" id="hw_sec"></a>
Hardware</h1>
<p>It consists of ESP32 microcontrollers, which is "HelTec WiFi Kit 32" -&mdash;&gt; <a href="https://heltec.org/project/wifi-kit-32/">https://heltec.org/project/wifi-kit-32/</a> Following board, hardware and libraries are used to develop this project.</p>
<h2><a class="anchor" id="peri"></a>
Peripherals</h2>
<ol type="1">
<li>OLED Built-in OLED Display -&mdash;&gt; <a href="https://heltec.org/project/wifi-kit-32/">https://heltec.org/project/wifi-kit-32/</a></li>
<li>SDS011 Sensor -&mdash;&gt; <a href="https://learn.watterott.com/sensors/sds011/">https://learn.watterott.com/sensors/sds011/</a></li>
<li>BME280 Sensor for Humidity and Temperature -&mdash;&gt; <a href="https://www.ebay.de/itm/3-3V-Bosch-BME280-Barometer-Luftdruck-Luftfeuchte-Sensor-Modul-BMP280-SPI-I2C-/263548911232">https://www.ebay.de/itm/3-3V-Bosch-BME280-Barometer-Luftdruck-Luftfeuchte-Sensor-Modul-BMP280-SPI-I2C-/263548911232</a> or <a href="https://eckstein-shop.de/SparkFun-Barometric-Pressure-Sensor-Breakout-MPL115A1?curr=EUR&gclid=Cj0KCQjww7HsBRDkARIsAARsIT6QsuuszbyaQ4r1DLuYTOT5pgwMfpIhRTtwQKAA2vtHkuHGrBZa9JQaAo-gEALw_wcB">https://eckstein-shop.de/SparkFun-Barometric-Pressure-Sensor-Breakout-MPL115A1?curr=EUR&amp;gclid=Cj0KCQjww7HsBRDkARIsAARsIT6QsuuszbyaQ4r1DLuYTOT5pgwMfpIhRTtwQKAA2vtHkuHGrBZa9JQaAo-gEALw_wcB</a></li>
<li>DHT22 Sensor for Temperature and Humidity -&mdash;&gt; <a href="https://www.sparkfun.com/products/10167">https://www.sparkfun.com/products/10167</a></li>
</ol>
<h2><a class="anchor" id="arduinoide"></a>
Arduino IDE</h2>
<p>The Arduino IDE Version 1.8 or later is needed. Please install from the official Arduino IDE download page. This step is not required if you already have the most recent version.</p>
<h3><a class="anchor" id="dialout"></a>
Pyserial</h3>
<p>If you use linux, you have to install the python pyserial package and add the current user to the dialout group: </p><pre><code class="text">
 sudo apt install python-pip
 pip install pyserial
 sudo /usr/sbin/usermod -a -G dialout &lt;MY_USER_NAME&gt;
 </code></pre><h3><a class="anchor" id="boardlib"></a>
ESP32 Arduino core</h3>
<p>Also, to apply AutoConnect to ESP32, the arduino-esp32 core provided by Espressif is needed. Stable 1.0.3 or required and the latest release is recommended. Install third-party platform using the Boards Manager of Arduino IDE (for instructions see here: <a href="https://github.com/espressif/arduino-esp32/blob/master/docs/arduino-ide/boards_manager.md">https://github.com/espressif/arduino-esp32/blob/master/docs/arduino-ide/boards_manager.md</a>). You can add multiple URLs into Additional Board Manager URLs field, separating them with commas. Package URL is <a href="https://dl.espressif.com/dl/package_esp32_index.json">https://dl.espressif.com/dl/package_esp32_index.json</a> for ESP32.</p>
<h3><a class="anchor" id="lib"></a>
Required Libraries</h3>
<p>Following are the commonly used libraries, and should be added in the Arduino IDE, before the compiling.</p><ol type="1">
<li>FIRMWARE_VERSION 0.1.0.0 onwards<ul>
<li>ESP32 Board by Espressif Systems v1.0.3 (<a href="https://github.com/espressif/arduino-esp32">https://github.com/espressif/arduino-esp32</a>)</li>
<li>Adafruit Unified Sensor by Adafruit v1.0.3 (<a href="https://github.com/adafruit/Adafruit_Sensor">https://github.com/adafruit/Adafruit_Sensor</a>)</li>
<li>Adafruit BME280 Library by Adafruit v1.0.8 (<a href="https://github.com/adafruit/Adafruit_BME280_Library">https://github.com/adafruit/Adafruit_BME280_Library</a>)</li>
<li>DHT sensor library by Adafruit v1.3.4 (<a href="https://github.com/adafruit/DHT-sensor-library">https://github.com/adafruit/DHT-sensor-library</a>)</li>
<li>eztime by Rop Gonggrijp v0.7.10 (<a href="https://github.com/ropg/ezTime">https://github.com/ropg/ezTime</a>)</li>
<li>name=SDS011 sensor Library by R. Zschiegner v0.0.6 (<a href="https://github.com/ricki-z/SDS011">https://github.com/ricki-z/SDS011</a>). This library is kept in src/lib/SDS011 folder. Even the library is updated on the github. But when tried to installed from library manager it is not installed properly for esp32.</li>
</ul>
</li>
</ol>
<h2><a class="anchor" id="upload"></a>
Firmware Uploading</h2>
<p>Following steps are recommended to upload the firmware before handing over the new crowd-sensor node.</p><ol type="1">
<li>To erase flash completely before delivering the product: "C:\Users\Sajjad\Documents\ArduinoData\packages\esp32\tools\esptool_py&gt;esptool.py --chip esp32 erase_flash" from the command terminal.</li>
<li>Upload the firmware using the Ardiuno IDE</li>
</ol>
<h1><a class="anchor" id="wiring"></a>
Wirings</h1>
<ol type="1">
<li>GPRS/GPS Module<br />
 There might be two different modules A7 or A9G. The wiring that just require pin definitions, as:<ul>
<li><a class="el" href="sensor_8h.html#ace67731836adaa94431a11f2f3afb49a" title="Debugging, uncomment to switch servers to use A9G Module otherwise A7.">gprsRX</a>, The GPRS Serial Receive pin</li>
<li><a class="el" href="sensor_8h.html#a5ab75e95ce2325b3ac18daff066d985d" title="GPRS TX Pin.">gprsTX</a>, The GPRS Serial Transmit pin</li>
<li><a class="el" href="sensor_8h.html#a54cd714ce172e08013354f7d6c56d135" title="GPS RX Pin.">gpsRX</a>, The GPS Serial Receive pin</li>
<li><a class="el" href="sensor_8h.html#ab42918d6ca01f71bd8dd82e1240c0fd5" title="GPS TX Pin.">gpsTX</a>, The GPS Serial Transmit pin</li>
<li><a class="el" href="sensor_8h.html#a1e69be52013b297b059ae19db0b250c0" title="GPRS PWR Pin.">gprsPWR</a>, The GPRS PWR_KEY pin</li>
<li><a class="el" href="sensor_8h.html#a2c31d1c293a323099296e12f60bdd606" title="GPRS RST Pin.">gprsRST</a>, The GPRS Reset pin</li>
</ul>
</li>
<li>SDS011 Dust Sensor<br />
 One has to:<ul>
<li>connect TXD of Dust Sensor SDS011 to Pin 13 of ESP32 (ESP-RX)</li>
<li>connect 5V of Dust Sensor SDS011 to Pin 5V of ESP32</li>
<li>connect GND of Dust Sensor SDS011 to Pin GND of ESP32</li>
</ul>
</li>
<li>BME280 Sensor for Humidity and Temperature<br />
<ul>
<li>connect SCK of BME280 sensor to Pin 22 of ESP32 (ESP-SCL)</li>
<li>connect SDA of BME280 sensor to Pin 21 of ESP32 (ESP-SDA)</li>
<li>connect VCC of BME280 sensor to 3V3 of ESP32</li>
<li>connect GND of BME280 sensor to GND of ESP32</li>
<li>the I2C address for different BME280 (purple/red) can be configure in <a class="el" href="sensor_8h.html" title="variable and definitions for sensors">sensor.h</a> using <a class="el" href="sensor_8h.html#a9f6149e98e70e1d5be5f0f33921cb7d7" title="BME280 I2C Address 0x77 for Red, 0x76 for Purple (chinese)">BME_ADDR</a> constant</li>
</ul>
</li>
<li>DHT22 Sensor for Temperature and Humidity (if BME280 is not used)<br />
 Look at the sensor from the front (grid shows in your direction), put the pins facing down, start counting the pins from left (pin1) to right (pin4). pin 3 is not connected.<br />
 One has to:<ul>
<li>Connect pin 1 of DHT22 sensor (on the left) to 3V3 of ESP32</li>
<li>Connect pin 2 of DHT22 sensor to Pin 21 of ESP32 (data)</li>
<li>Connect pin 4 of DHT22 sensor (on the right) to GND of ESP32</li>
<li>Connect a resistor in range 4.7k to 10k from pin 2 (data) to pin 1 (power) of the sensor</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="knownbugs"></a>
Known Bugs</h1>
<p>There are following bugs and discrepensies that needs to be take care off.</p><ol type="1">
<li>xxx</li>
<li>yyyy</li>
</ol>
<h1><a class="anchor" id="changelog"></a>
Change Log</h1>
<h2><a class="anchor" id="changelog2"></a>
FIRMWARE_VERSION 0.1.0.0 onwards</h2>
<ul>
<li>[0.1.0.0] Sep. 7, 2020<ul>
<li>First State Machine and integration of whole sensors</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="author"></a>
Author(s)</h1>
<ul>
<li>Sajjad Hussain,</li>
<li>Tobias Röddiger,</li>
</ul>
<p>The team at TECO (www.teco.edu) and at Chair for Pervasive Computing Systems (<a href="https://pcs.tm.kit.edu">https://pcs.tm.kit.edu</a>).</p>
<h1><a class="anchor" id="license"></a>
License</h1>
<p>This code belongs to TECO www.teco.edu and must be reffered when used. BSD license, all text here must be included in any redistribution. </p>
<h2><a class="anchor" id="ack"></a>
Acknowledgments</h2>
<p>The following libraries were used:<br />
</p><ul>
<li>Espressif Systems: Licenses and Copyright 2015-2016 Espressif Systems (Shanghai) PTE LTD</li>
<li>Adafruit BME280 is licensed under Adafruit. <a href="https://adafruit.com/">https://adafruit.com/</a></li>
<li>DHT sensor is licensed under Adafruit. <a href="https://adafruit.com/">https://adafruit.com/</a></li>
<li>ezTime is licensed under the MIT License. <a href="https://github.com/ropg/ezTime">https://github.com/ropg/ezTime</a></li>
<li>SDS011 sensor Library is licensed under the MIT License. (<a href="https://github.com/ricki-z/SDS011">https://github.com/ricki-z/SDS011</a>)</li>
</ul>
<h2><a class="anchor" id="mit"></a>
MIT License</h2>
<pre class="fragment">   Copyright (c) 2017-2019 Hieromon Ikasamo

   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated documentation files (the "Software"), to deal
   in the Software without restriction, including without limitation the rights
   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the Software is
   furnished to do so, subject to the following conditions:

   The above copyright notice and this permission notice shall be included in all
   copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   SOFTWARE.
</pre><h2><a class="anchor" id="EspressifLic"></a>
Espressif Systems License</h2>
<pre class="fragment">   Copyright 2015-2016 Espressif Systems (Shanghai) PTE LTD

   Licensed under the Apache License, Version 2.0 (the "License");    
   you may not use this file except in compliance with the License.    
   You may obtain a copy of the License at    
   http://www.apache.org/licenses/LICENSE-2.0    
   Unless required by applicable law or agreed to in writing, software    
   distributed under the License is distributed on an "AS IS" BASIS,    
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.    
   See the License for the specific language governing permissions and    
   limitations under the License.
</pre><dl class="section date"><dt>Date</dt><dd>07.09.2020 </dd></dl>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
